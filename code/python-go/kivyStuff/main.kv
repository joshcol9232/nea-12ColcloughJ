# File name: kiv.py
#: import FadeTransition kivy.uix.screenmanager.FadeTransition
#: import Window kivy.core.window.Window

ScreenManagement:
    id: screenmanager
    transition: FadeTransition()
    LoginScreen:
        name: "Login"
        id: login
        manager: screenmanager
    MainScreen:
        name: "main"
        id: main
        manager: screenmanager
        key: login.globalKey

<listButton@Button>:
    font_size: 14
    size_hint: 1, None
    text:
    on_release: root.outerScreen.traverseButton(self.text)


# <nameSortButton@Button>:
#     font_size: 14
#     size_hint: .7, .015
#     pos_hint: {"x": .005, "y": .805}
#     text: root.getSortOrder()
#     on_release: root.changeSortOrder()

<infoButton@Button>:
    font_size: 14
    size_hint: 1, None
    text:
    on_release: root.outerScreen.getFileInfo(self.fileReference)

<infoLabel@Label>:
    text_size: self.width, None
    height: self.texture_size[1]

<deleteButton@Button>:
    on_release: root.outerScreen.deleteFile(self.fileDir)

# <SettingsPop@Popup>:
#     id: settings
#     GridLayout:
#         cols: 2
#         Label:
#             size_hint: .32, .08
#             font_size: 18
#             text: "Current vault location:"+root.outerScreen.path



<ConfirmationPopup@Popup>:
    title: "Confirmation"
    size_hint: .4, .4
    pos_hint: {"center_x": .5, "center_y": .5}
    auto_dismiss: False
    FloatLayout:
        Label:
            text: "Are you sure?"
            pos_hint: {"center_x": .5, "center_y": .7}
        Button:
            text: "No!!!"
            pos_hint: {"center_x": .25, "center_y": .25}
            size_hint: .4, .3
            on_release: root.fileScreen.outerScreen.dismiss()

        Button:
            text: "Yes"
            pos_hint: {"center_x": .75, "center_y": .25}
            size_hint: .4, .3
            on_release: root.dismiss();root.fileScreen.outerScreen.checkCanEncrypt(root.inputText)

<LoginScreen>:
    keyInput: keyInput

    # Label:
    #     id: labelLogin
    #     size_hint: .46, .08
    #     text: "Connect via bluetooth."
    #     font_size: 22
    #     pos_hint: {"center_x": 0.5, "y": 0.8}

    # Button:
    #     id: loginButton
    #     size_hint: .16, .16
    #     pos_hint: {"center_x": .5, "center_y": .5}
    #     on_release: app.root.current = "main";root.lockList = [];root.unlock = False
    #     text: "bypass"

    # Button:
    #     id: checkbutton
    #     size_hint: .16, .16
    #     pos_hint: {"center_x": .5, "center_y": .34}
    #     on_release: root.unlock = root.checkValid()
    #     text: "Check Code Sent"

    Label:
        id: labelLogin
        size_hint: .46, .08
        text: root.needToSetKey()
        font_size: 22
        pos_hint: {"center_x": 0.5, "y": 0.8}

    TextInput:
        id: keyInput
        size_hint: .7, .08
        font_size: 22
        hint_text: "Key (16 characters maximum)"
        pos_hint: {"center_x": 0.5, "center_y": 0.6}
        password: True
        multiline: False
        on_text_validate: app.root.current = root.checkKey(keyInput.text)

    Button:
        id: submitKey
        size_hint: .16, .16
        font_size: 22
        text: "Submit"
        pos_hint: {"center_x": 0.5, "center_y": 0.4}
        #on_release: app.root.current = root.checkKey(keyInput.text)
        on_release: root.checkKey(keyInput.text)


<MainScreen>:
    addFile: addFile
    key: root.key

    FloatLayout:
        id: MainLayout


        TextInput:
            id: Search
            size_hint: .46, .08
            font_size: 22
            hint_text: "Search"
            pos_hint: {"x": 0.16, "top": 1}
            multiline: False
            on_text_validate: root.searchForItem(root.quickSortAlph(root.List(root.currentDir)), self.text)


        # Button:
        #     id: SortByName
        #     font_size: 14
        #     size_hint: .7, .015
        #     pos_hint: {"x": .005, "y": .805}
        #     text: root.getSortOrder()
        #     on_release: root.changeSortOrder()

        Button:
            id: goBackArrow
            size_hint: .06, .08
            pos_hint: {"x": .62, "y": 0.84}
            on_release: root.resetButtons()
            Image:
                source: root.getPathForButton("backArrows.png")
                x: self.parent.x + 5
                y: self.parent.y
                size: 50, 50
                allow_stretch: True

        Button:
            id: settings
            size_hint: .06, .08
            pos_hint: {"x": 0.62, "top": 1}
            on_release: a = root.SettingsPop(root, title="Settings");a.open()
            Image:
                source: root.getPathForButton("settings.png")
                x: self.parent.x + 10
                y: self.parent.y + 4
                size: 40, 40
                allow_stretch: True

        Button:     #Padlock
            id: LogOut
            size_hint: .16, .16
            pos_hint: {"x": 0, "top": 1}
            on_release: app.root.current = "Login"
            Image:
                source: root.getPathForButton("padlock.png")
                x: self.parent.x - 20
                y: self.parent.y - 70
                size: 200, 267 #1 : 1.3353 ratio
                allow_stretch: True

        Button:
            id: addFile
            size_hint: .16, .16
            pos_hint: {"right": 1, "top": 1}
            on_release: root.addFile = root.addFileScreen(root, title="Add File");root.addFile.open()
            Image:
                source: root.getPathForButton("addFile.png")
                x: self.parent.x - 33
                y: self.parent.y - 73

                size: 250, 267
                allow_stretch: True

        Button:
            id: goBackFolder
            size_hint: .16, .16
            pos_hint: {"x": 0.68, "top": 1}
            on_release: root.goBackFolder()
            Image:
                source: root.getPathForButton("backUpFolder.png")
                x: self.parent.x - 33
                y: self.parent.y - 73
                size: 250, 267
                allow_stretch: True

        Button:
            id: manuallyRefresh
            size_hint: .06, .08
            pos_hint: {"right": 1, "y": 0.76}
            on_release: root.resetButtons()
            Image:
                source: root.getPathForButton("refresh-icon.png")
                x: self.parent.x - 10
                y: self.parent.y - 30
                size: 80, 112
                allow_stretch: True


        ProgressBar:
            id: pb1
            min: 0
            max: root.values(False)[0]
            value: root.values(False)[1]
            size_hint: .46, .08
            pos_hint: {"x": 0.16, "y": 0.84}

        Label:
            pos_hint: {"x": 0.4, "y": 0.82}
            size_hint: .16, .16
            text: root.values(True)

        # CheckBox:
        #     pos_hint: {"x": 0.95, "y": 0.5}
        #     size_hint: .05, .05



<addFileScreen@Popup>:
    name: "addFile"
    id: addFile
    submitDirs: submitDirs
    FloatLayout:
        Label:
            size_hint: .46, .08
            font_size: 18
            text: "Enter the directories what files you would like to encrypt (can be a folder).\nYou can seperate each directory with a ':' if you want to do multiple locations."
            pos_hint: {"center_x": 0.5, "y": 0.8}

        Button:
            id: submitDirs
            size_hint: .16, .16
            pos_hint: {"center_x": .5, "center_y": .4}
            text: "Submit"
            on_release: root.checkIfSure(Search.text)

        Button:
            id: cancel
            size_hint: .16, .08
            pos_hint: {"center_x": .5, "center_y": .24}
            text: "Close"
            on_release: root.dismiss()

        TextInput:
            id: Search
            size_hint: .7, .08
            font_size: 22
            hint_text: "Directories"
            pos_hint: {"center_x": 0.5, "center_y": 0.7}
            multiline: False


<SettingsPop@Popup>:
    auto_dismiss: False
    newLoc: newLoc
    GridLayout:
        cols: 2
        Label:
            text: "Vault Location:"
            font_size: 20
        Label:
            text: root.outerScreen.path
            font_size: 14
        Label:
            text: "Change Vault Location:"
            font_size: 16
        GridLayout:
            cols: 2
            TextInput:
                id: newLoc
                size_hint_x: .85
                font_size: 22
                hint_text: "Location"
            Button:
                size_hint_x: .15
                text: "Submit"
                on_release: root.changeVaultLoc(newLoc.text)

        Label:
        Label:
        Label:
        Label:
        Label:
        Label:
        Label:
        Label:

        Button:
            text: "Exit"
            font_size: 20

            on_release: root.dismiss()
